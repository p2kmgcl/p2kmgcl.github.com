---
layout: default
title: Counter
description: Show the difference between a date and now
---

<dialog id="settingsDialog">
  <form id="settingsForm" method="dialog">
    <label>
      <span>Begin date:</span>
      <input id="beginDate" name="beginDate" type="datetime-local" />
    </label>

    <div>
      <button type="cancel" value="cancel">
        Cancel
      </button>

      <button type="submit" value="submit">
        Save settings
      </button>
    </div>
  </form>
</dialog>

<menu class="menu">
  <button class="button" id="settingsButton" type="button">
    <img src="./settings.svg" alt="" />
    <span class="sr-only">Show settings</span>
  </button>
</menu>

<main class="main" aria-live="polite">
  <p id="help">Choose a date to see the difference between this and now.</p>

  <time id="timer" role="timer" style="display:none;" aria-atomic="true">
    <p><span id="days"></span> days.</p>
    <p><span id="hours"></span> hours.</p>
    <p><span id="minutes"></span> minutes.</p>
    <p><span id="seconds"></span> seconds.</p>
  </time>
</main>

<style>
  .menu {
    margin: 0;
    padding: 0;
  }

  .button {
    position: absolute;
    top: 1em;
    right: 1em;
    border: none;
    background: transparent;
    padding: 1em;
    border-radius: 50%;
      display: flex;
  }

  .sr-only {
    position: absolute;
    top: -99999px;
    left: -99999px;
    opacity: 0;
  }

  .main {
    display: flex;
    justify-content: center;
    align-items: center;
    min-width: 100vw;
    min-height: 100vh;
    padding: 16px;
    box-sizing: border-box;
    font-size: 32px;
  }

  .main p {
    margin: 0;
    max-width: 32ch;
  }

  dialog {
    width: 90%;
    max-width: 50ch;
    box-sizing: border-box;
    border-radius: 8px;
      box-shadow: 0 0 10vmax rgba(0, 0, 0, 0.4);
        border: solid rgba(0, 0, 0, 0.6) 2px;
          padding: 32px 16px;
  }

  input,
  button {
    font-family: inherit;
      font-size: 1rem;
            padding: 4px 8px;
      border-radius: 4px;
        border: solid black thin;
          background: transparent;
            box-shadow: inset 0 -2px 0 rgba(0, 0, 0, 0.2);
  }

  input:focus,
  button:focus {
    outline: none;
      box-shadow: 0 0 0 2px white, 0 0 0 4px #fabada;
  }

  input {
    display: block;
      width: 100%;
        box-sizing: border-box;
          margin: 12px auto 32px;
  }

  button {
    cursor: pointer;
      padding: 6px 12px;
  }

  button + button {
    margin-left: 0.5ch;
  }

  form div {
    text-align: right;
  }

  time {
    font-size: 10vmin;
  }

  time span {
    font-family: monospace;
      white-space: pre;
  }
</style>

<script>
  document.getElementById('settingsButton').addEventListener('click', () => {
    document.getElementById('settingsDialog').showModal();
  });

  document.getElementById('settingsForm').addEventListener('submit', (event) =>
    requestAnimationFrame(() => {
      if (document.getElementById('settingsDialog').returnValue === 'submit') {
        const dateString = event.target.elements.beginDate.value;
        window.location.hash = `#${dateString}`;

        if (dateString) {
          renderDate(new Date(dateString));
        } else {
          renderHelp();
        }
      }
    }),
  );

  const MS_TO_SECOND = 1000;
  const MS_TO_MINUTE = MS_TO_SECOND * 60;
  const MS_TO_HOUR = MS_TO_MINUTE * 60;
  const MS_TO_DAY = MS_TO_HOUR * 24;

  const timer = document.getElementById('timer');
  const help = document.getElementById('help');
  let renderIntervalId;

  function renderDate(date) {
    const dateTime = date.getTime();
    const daysElement = document.getElementById('days');
    const hoursElement = document.getElementById('hours');
    const minutesElement = document.getElementById('minutes');
    const secondsElement = document.getElementById('seconds');

    const tick = () => {
      let delta = Math.abs(Date.now() - dateTime);
      let pad = 3;

      const days = Math.floor(delta / MS_TO_DAY);
      daysElement.innerText = days.toString().padStart(pad, ' ');
      delta -= days * MS_TO_DAY;
      pad = daysElement.innerText.length;

      const hours = Math.floor(delta / MS_TO_HOUR);
      hoursElement.innerText = hours.toString().padStart(pad, ' ');
      delta -= hours * MS_TO_HOUR;

      const minutes = Math.floor(delta / MS_TO_MINUTE);
      minutesElement.innerText = minutes.toString().padStart(pad, ' ');
      delta -= minutes * MS_TO_MINUTE;

      const seconds = Math.floor(delta / MS_TO_SECOND);
      secondsElement.innerText = seconds.toString().padStart(pad, ' ');
      delta -= seconds * MS_TO_SECOND;

      timer.dateTime = `PT${days}D${hours}H${minutes}M${seconds}S`;
    };

    clearInterval(renderIntervalId);
    renderIntervalId = setInterval(tick, 500);
    tick();
    help.style.display = 'none';
    timer.style.display = 'block';
  }

  function renderHelp() {
    help.style.display = 'block';
    timer.style.display = 'none';

    clearInterval(renderIntervalId);
  }

  const hashDate = window.location.hash.substr(1);

  if (!isNaN(new Date(hashDate).getTime())) {
    document.getElementById('beginDate').value = hashDate;
    renderDate(new Date(hashDate));
  }
</script>
